{
  "name": "stg_get_air_mbl",
  "description": "Returns Job details for Air Imports Shipment based on Master Airway Bill Number",
  "type": "custom_function",
  "tags": ["stg-usa", "air-imports", "tracking"],
  "inputs": [
    {
      "name": "masterAirWayBillNumber",
      "type": "text",
      "description": "Master Airway Bill Number to search",
      "required": true,
      "validators": [
        {
          "type": "not_empty",
          "message": "Master Airway Bill Number is required"
        }
      ]
    }
  ],
  "outputs": [
    {
      "name": "result",
      "type": "object",
      "description": "Air CFS Job Details"
    },
    {
      "name": "success",
      "type": "boolean"
    },
    {
      "name": "error",
      "type": "object",
      "nullable": true
    }
  ],
  "function_stack": [
    {
      "id": "build_endpoint",
      "function": "text_concat",
      "comment": "Build the API endpoint path",
      "output": "endpoint",
      "params": {
        "items": [
          "/air/mbl/",
          { "var": "masterAirWayBillNumber" }
        ]
      }
    },
    {
      "id": "call_stg_api",
      "function": "custom_function",
      "comment": "Call STG base request function",
      "output": "api_result",
      "params": {
        "name": "stg_base_request",
        "inputs": {
          "endpoint": { "var": "endpoint" },
          "method": "GET"
        }
      }
    },
    {
      "id": "check_success",
      "function": "conditional",
      "output": "is_success",
      "params": {
        "if": { "var": "api_result.success" },
        "then": true,
        "else": false
      }
    },
    {
      "id": "handle_error",
      "function": "conditional",
      "comment": "Handle error if request failed",
      "output": "error_result",
      "params": {
        "if": {
          "not": { "var": "is_success" }
        },
        "then": {
          "function": "custom_function",
          "params": {
            "name": "stg_error_handler",
            "inputs": {
              "response": { "var": "api_result.response" },
              "status_code": { "var": "api_result.status_code" },
              "operation": "get_air_mbl"
            }
          }
        },
        "else": null
      }
    },
    {
      "id": "return_result",
      "function": "return",
      "params": {
        "result": { "var": "api_result.response" },
        "success": { "var": "is_success" },
        "error": { "var": "error_result.error" }
      }
    }
  ]
}
