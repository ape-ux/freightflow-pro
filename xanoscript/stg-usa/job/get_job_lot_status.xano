{
  "name": "stg_get_job_lot_status",
  "description": "Returns status of a Job Lot Number",
  "type": "custom_function",
  "tags": ["stg-usa", "job", "status"],
  "inputs": [
    {
      "name": "jobLotNumber",
      "type": "text",
      "description": "Job Lot Number to check status",
      "required": true,
      "validators": [
        {
          "type": "not_empty",
          "message": "Job Lot Number is required"
        }
      ]
    }
  ],
  "outputs": [
    {
      "name": "result",
      "type": "object",
      "description": "Job Lot Status"
    },
    {
      "name": "success",
      "type": "boolean"
    },
    {
      "name": "error",
      "type": "object",
      "nullable": true
    }
  ],
  "function_stack": [
    {
      "id": "build_endpoint",
      "function": "text_concat",
      "output": "endpoint",
      "params": {
        "items": [
          "/status/",
          { "var": "jobLotNumber" }
        ]
      }
    },
    {
      "id": "call_stg_api",
      "function": "custom_function",
      "output": "api_result",
      "params": {
        "name": "stg_base_request",
        "inputs": {
          "endpoint": { "var": "endpoint" },
          "method": "GET"
        }
      }
    },
    {
      "id": "check_success",
      "function": "conditional",
      "output": "is_success",
      "params": {
        "if": { "var": "api_result.success" },
        "then": true,
        "else": false
      }
    },
    {
      "id": "handle_error",
      "function": "conditional",
      "output": "error_result",
      "params": {
        "if": { "not": { "var": "is_success" } },
        "then": {
          "function": "custom_function",
          "params": {
            "name": "stg_error_handler",
            "inputs": {
              "response": { "var": "api_result.response" },
              "status_code": { "var": "api_result.status_code" },
              "operation": "get_job_lot_status"
            }
          }
        },
        "else": null
      }
    },
    {
      "id": "return_result",
      "function": "return",
      "params": {
        "result": { "var": "api_result.response" },
        "success": { "var": "is_success" },
        "error": { "var": "error_result.error" }
      }
    }
  ]
}
